/* Dropdown Performance Optimizations
 * Specifically targets narrow screens with scrollbars where dropdowns lag
 */

/* Base dropdown optimizations for all Mantine dropdowns */
[data-mantine-dropdown],
[data-combobox-dropdown] {
  /* Hardware acceleration for smoother animations */
  will-change: transform, opacity;
  backface-visibility: hidden;
  transform: translateZ(0); /* Force GPU acceleration */
  
  /* Optimize scrolling performance */
  overflow-anchor: none; /* Prevent anchor scrolling issues */
  contain: layout style paint; /* CSS containment for better performance */
}

/* Optimizations for dropdowns in scrollable containers */
[data-mantine-modal] [data-mantine-dropdown],
[data-mantine-modal] [data-combobox-dropdown],
.mantine-ScrollArea-viewport [data-mantine-dropdown],
.mantine-ScrollArea-viewport [data-combobox-dropdown] {
  /* Disable expensive visual effects in scrollable containers */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important; /* Simplified shadow */
  backdrop-filter: none !important; /* Disable backdrop blur */
  
  /* Force simple positioning */
  position: absolute !important;
  transform: none !important;
}

/* Mobile and narrow screen optimizations */
@media (max-width: 1024px), (max-height: 768px) {
  [data-mantine-dropdown],
  [data-combobox-dropdown] {
    /* Disable transitions on narrow screens to prevent jank */
    transition: none !important;
    animation: none !important;
    
    /* Simplify rendering */
    border-radius: 4px !important; /* Smaller radius for better performance */
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1) !important; /* Simplified shadow */
  }
  
  /* Force dropdowns to stay within viewport on narrow screens */
  [data-mantine-dropdown]:not([data-mantine-portal]),
  [data-combobox-dropdown]:not([data-mantine-portal]) {
    max-height: 200px !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }
}

/* Specific optimizations for Select components in forms */
.mantine-Select-dropdown {
  /* Optimize scrollable areas */
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
}

.mantine-Select-dropdown::-webkit-scrollbar {
  width: 6px;
}

.mantine-Select-dropdown::-webkit-scrollbar-track {
  background: transparent;
}

.mantine-Select-dropdown::-webkit-scrollbar-thumb {
  background-color: #ccc;
  border-radius: 3px;
}

/* Combobox specific optimizations */
.mantine-Combobox-dropdown {
  /* Force hardware acceleration */
  transform: translateZ(0);
  will-change: transform, opacity;
  
  /* Optimize overflow */
  contain: layout style;
}

.mantine-Combobox-options {
  /* Smooth scrolling */
  scroll-behavior: auto; /* Disable smooth scrolling to prevent lag */
  overscroll-behavior: contain; /* Prevent scroll chaining */
}

/* Emergency performance mode - disable all animations and effects */
.performance-emergency [data-mantine-dropdown],
.performance-emergency [data-combobox-dropdown],
.performance-minimal [data-mantine-dropdown],
.performance-minimal [data-combobox-dropdown] {
  transition: none !important;
  animation: none !important;
  transform: none !important;
  will-change: auto !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
  border-radius: 2px !important;
}

/* Hide dropdowns during rapid scrolling to prevent stutter */
.scrolling-rapidly [data-mantine-dropdown],
.scrolling-rapidly [data-combobox-dropdown] {
  visibility: hidden !important;
}

/* Constrained viewport optimizations */
@media (max-width: 1024px) and (max-height: 768px) {
  /* Force simpler rendering on very constrained screens */
  [data-mantine-dropdown],
  [data-combobox-dropdown] {
    filter: none !important; /* Remove any filters */
    backdrop-filter: none !important;
    mix-blend-mode: normal !important;
    isolation: auto !important;
  }
  
  /* Reduce option padding to fit more items */
  .mantine-Select-option,
  .mantine-Combobox-option {
    padding: 4px 8px !important;
    line-height: 1.3 !important;
  }
}

/* Accessibility: Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  [data-mantine-dropdown],
  [data-combobox-dropdown] {
    transition: none !important;
    animation: none !important;
  }
}

/* Prevent layout thrashing during dropdown open/close */
.dropdown-container {
  contain: layout;
  position: relative;
}

/* Optimize Mantine specific classes */
.mantine-Select-input:focus + [data-mantine-dropdown],
.mantine-Combobox-input:focus + [data-combobox-dropdown] {
  /* Ensure smooth opening */
  transform: translateZ(0);
}